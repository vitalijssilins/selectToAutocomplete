(function(d){var a={sort:false,"sort-attr":"data-priority","sort-desc":false,autoselect:true,"free-insert":false,flags:false,"flags-attr":"data-flag","flags-dir":"./flags/","flags-default":"LV","flags-image-selector":"#flag",code:false,"code-show":false,"code-attr":"data-code","code-default":"371","code-selector":"#code",price:false,"price-attr":"data-price","price-default":"0","price-currency":"&euro;","alternative-spellings":true,"alternative-spellings-attr":"data-alternative-spellings","remove-valueless-options":true,"copy-attributes-to-text-field":true,"autocomplete-plugin":"jquery_ui","relevancy-sorting":true,"relevancy-sorting-partial-match-value":2,"relevancy-sorting-strict-match-value":5,"relevancy-sorting-booster-attr":"data-relevancy-booster",handle_invalid_input:function(e){if(!a["free-insert"]){e.$text_field.val(e.$select_field.find("option:selected:first").val())}},handle_select_field:function(e){return e.hide()},insert_text_field:function(k){var f=d("<input></input>");if(a["copy-attributes-to-text-field"]){var g={};var e=k.$select_field[0].attributes;for(var j=0;j<e.length;j++){var h=e[j].nodeName;var l=e[j].nodeValue;if(h!=="name"&&h!=="id"&&typeof k.$select_field.attr(h)!=="undefined"){g[h]=l}}f.attr(g)}f.blur(function(){var i=k.$select_field.find("option").map(function(m,n){return d(n).val()});if(!(f.val() in i)&&typeof a.handle_invalid_input==="function"){a.handle_invalid_input(k)}});if(k.settings.autoselect){f.click(function(){this.select()})}return f.val(k.$select_field.find("option:selected:first").val()).insertAfter(k.$select_field)},extract_options:function(f){var h=[];var e=f.find("option");var g=e.length;e.each(function(){var o=d(this);var k={"real-value":o.attr("value"),label:o.val(),text:o.text()};if(a["remove-valueless-options"]&&k["real-value"]===""){}else{if(a.flags){k.flag=k["flags-default"];var i=o.attr(a["flags-attr"]);if(i){k.flag=i}}if(a.code){k.code=a["code-default"];var m=o.attr(a["code-attr"]);if(m){k.code=m}}if(a.price){k.price=a["price-default"];var l=o.attr(a["price-attr"]);if(l){k.price=l}}k.matches=k.label;var p=o.attr(a["alternative-spellings-attr"]);if(p){k.matches+=" "+p;if(m){k.matches+=" 00"+m+" +"+m+" "+m}}if(a.sort){var n=parseInt(o.attr(a["sort-attr"]),10);if(n){k.weight=n}else{k.weight=g}}if(a["relevancy-sorting"]){k["relevancy-score"]=0;k["relevancy-score-booster"]=1;var j=parseFloat(o.attr(a["relevancy-sorting-booster-attr"]));if(j){k["relevancy-score-booster"]=j}}h.push(k)}});if(a.sort){if(a["sort-desc"]){h.sort(function(j,i){return i.weight-j.weight})}else{h.sort(function(j,i){return j.weight-i.weight})}}return h},source:function(f,e){},select:function(e,f){}};var c={init:function(e){if(d.browser.msie&&parseInt(d.browser.version,10)<=6){return this}else{a=d.extend({},a,e);return this.each(function(){var f=d(this);var g={"$select_field":f,options:a.extract_options(f),settings:a};g["$text_field"]=a.insert_text_field(g);a.handle_select_field(f);if(typeof a["autocomplete-plugin"]==="string"){b[a["autocomplete-plugin"]](g)}else{a["autocomplete-plugin"](g)}})}}};var b={jquery_ui:function(g){var j=function(m){var n=m.split(" ");var k=[];for(var l=0;l<n.length;l++){if(n[l].length>0){var o={};o.partial=new RegExp(d.ui.autocomplete.escapeRegex(n[l]),"i");if(g.settings["relevancy-sorting"]){o.strict=new RegExp("^"+d.ui.autocomplete.escapeRegex(n[l]),"i")}k.push(o)}}return d.grep(g.options,function(v){var p=0;if(g.settings["relevancy-sorting"]){var s=false;var u=v.matches.split(" ")}for(var t=0;t<k.length;t++){if(k[t]["partial"].test(v.matches)){p++}if(g.settings["relevancy-sorting"]){for(var w=0;w<u.length;w++){if(k[t]["strict"].test(u[w])){s=true;break}}}}if(g.settings["relevancy-sorting"]){var r=0;r+=p*g.settings["relevancy-sorting-partial-match-value"];if(s){r+=g.settings["relevancy-sorting-strict-match-value"]}r=r*v["relevancy-score-booster"];v["relevancy-score"]=r}return(!m||k.length===p)})};var h=function(k){var n;do{n=false;for(var m=0;m<k.length-1;m++){if(k[m]["relevancy-score"]<k[m+1]["relevancy-score"]){var l=k[m];k[m]=k[m+1];k[m+1]=l;n=true}}}while(n);return k};var i=function(k){if(g.settings.flags&&(typeof(k)!=="undefined")){d(g.settings["flags-image-selector"]).attr("src",g.settings["flags-dir"]+k.flag+".png")}};var e=function(l){if(l){if(g.$select_field.val()!==l["real-value"]){g.$select_field.val(l["real-value"]);i(l);if(g.settings.code&&g.settings["code-show"]){if(l.code){d(g.settings["code-selector"]).text("+"+l.code)}else{d(g.settings["code-selector"]).text("+"+g.settings["code-default"])}}g.$select_field.change()}}else{var m=g.$text_field.val().toLowerCase();var n={"real-value":false};for(var k=0;k<g.options.length;k++){if(m===g.options[k]["label"].toLowerCase()){n=g.options[k];break}}if(g.$select_field.val()!==n["real-value"]){g.$select_field.val(n["real-value"]||"");g.$select_field.change()}if(n["real-value"]){g.$text_field.val(n.label)}if(typeof g.settings.handle_invalid_input==="function"&&g.$select_field.val()===""){g.settings.handle_invalid_input(g)}}};var f=false;g.$text_field.autocomplete({minLength:0,delay:0,autoFocus:true,position:{my:"left+150 top",at:"left bottom"},source:function(l,k){var m=j(l.term);if(g.settings["relevancy-sorting"]){m=h(m)}k(m);if(l.term){i(m[0])}g.settings.source(l,m)},select:function(k,l){e(l.item);var m=[l.item];i(m[0]);g.settings.select(k,l)},open:function(k,l){f=true},close:function(k,l){f=false},change:function(k,l){e(l.item)},search:function(k,l){}}).data("autocomplete")._renderItem=function(k,l){if(g.settings.flags&&g.settings.code&&g.settings.price){return d("<li>").data("item.autocomplete",l).append('<a><div class="flag-img"><img src="'+g.settings["flags-dir"]+l.flag+'.png" /></div><p class="country-name">'+l.text+'</p><p class="country-code">+'+l.code+'</p><p class="country-price">'+g.settings["price-currency"]+" "+l.price+'</p></a><div style="clear:both"></div>').appendTo(k)}else{if(g.settings.flags&&g.settings.code&&!g.settings.price){return d("<li>").data("item.autocomplete",l).append('<a><div class="flag-img"><img src="'+g.settings["flags-dir"]+l.flag+'.png" /></div><p class="country-name">'+l.text+'</p><p class="country-code">+'+l.code+'</p></a><div style="clear:both"></div>').appendTo(k)}else{if(g.settings.flags&&!g.settings.code&&!g.settings.price){return d("<li>").data("item.autocomplete",l).append('<a><div class="flag-img"><img src="'+g.settings["flags-dir"]+l.flag+'.png" /></div><p class="country-name">'+l.text+'</p><p class="country-price">'+g.settings["price-currency"]+" "+l.price+'</p></a><div style="clear:both"></div>').appendTo(k)}else{if(!g.settings.flags&&g.settings.code&&g.settings.price){return d("<li>").data("item.autocomplete",l).append('<a><p class="country-name">'+l.text+'</p><p class="country-code">+'+l.code+'</p><p class="country-price">'+g.settings["price-currency"]+" "+l.price+'</p></a><div style="clear:both"></div>').appendTo(k)}else{if(!g.settings.flags&&!g.settings.code&&g.settings.price){return d("<li>").data("item.autocomplete",l).append('<a><p class="country-name">'+l.text+'</p><p class="country-price">'+g.settings["price-currency"]+" "+l.price+'</p></a><div style="clear:both"></div>').appendTo(k)}else{return d("<li>").data("item.autocomplete",l).append('<a><p class="country-name">'+l.text+'</p></a><div style="clear:both"></div>').appendTo(k)}}}}}};g.$text_field.parents("form:first").submit(function(){e()});e();if(g.settings.flags){d(g.settings["flags-image-selector"]).click(function(){if(f){g.$text_field.autocomplete("close")}else{g.$text_field.autocomplete("search","")}})}}};d.fn.selectToAutocomplete=function(e){if(c[e]){return c[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return c.init.apply(this,arguments)}else{d.error("Method "+e+" does not exist on jQuery.fn.selectToAutocomplete")}}}})(jQuery);