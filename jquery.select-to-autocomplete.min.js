(function(d){var a={sort:false,"sort-attr":"data-priority","sort-desc":false,autoselect:true,"free-insert":false,flags:false,"flags-attr":"data-flag","flags-dir":"./flags/","flags-default":"LV","flags-image-selector":"#flag",code:false,"code-show":false,"code-attr":"data-code","code-default":"371","code-selector":"#code","alternative-spellings":true,"alternative-spellings-attr":"data-alternative-spellings","remove-valueless-options":true,"copy-attributes-to-text-field":true,"autocomplete-plugin":"jquery_ui","relevancy-sorting":true,"relevancy-sorting-partial-match-value":2,"relevancy-sorting-strict-match-value":5,"relevancy-sorting-booster-attr":"data-relevancy-booster",handle_invalid_input:function(e){if(!a["free-insert"]){e.$text_field.val(e.$select_field.find("option:selected:first").val())}},handle_select_field:function(e){return e.hide()},insert_text_field:function(k){var f=d("<input></input>");if(a["copy-attributes-to-text-field"]){var g={};var e=k.$select_field[0].attributes;for(var j=0;j<e.length;j++){var h=e[j].nodeName;var l=e[j].nodeValue;if(h!=="name"&&h!=="id"&&typeof k.$select_field.attr(h)!=="undefined"){g[h]=l}}f.attr(g)}f.blur(function(){var i=k.$select_field.find("option").map(function(m,n){return d(n).val()});if(!(f.val() in i)&&typeof a.handle_invalid_input==="function"){a.handle_invalid_input(k)}});if(k.settings.autoselect){f.click(function(){this.select()})}return f.val(k.$select_field.find("option:selected:first").val()).insertAfter(k.$select_field)},extract_options:function(f){var h=[];var e=f.find("option");var g=e.length;e.each(function(){var n=d(this);var k={"real-value":n.attr("value"),label:n.val(),text:n.text()};if(a["remove-valueless-options"]&&k["real-value"]===""){}else{k.flag=k["flags-default"];var i=n.attr(a["flags-attr"]);if(i){k.flag=i}k.code=k["code-default"];var l=n.attr(a["code-attr"]);if(l){k.code=l}k.matches=k.label;var o=n.attr(a["alternative-spellings-attr"]);if(o){k.matches+=" "+o;if(l){k.matches+=" 00"+l+" +"+l+" "+l}}if(a.sort){var m=parseInt(n.attr(a["sort-attr"]),10);if(m){k.weight=m}else{k.weight=g}}if(a["relevancy-sorting"]){k["relevancy-score"]=0;k["relevancy-score-booster"]=1;var j=parseFloat(n.attr(a["relevancy-sorting-booster-attr"]));if(j){k["relevancy-score-booster"]=j}}h.push(k)}});if(a.sort){if(a["sort-desc"]){h.sort(function(j,i){return i.weight-j.weight})}else{h.sort(function(j,i){return j.weight-i.weight})}}return h}};var c={init:function(e){if(d.browser.msie&&parseInt(d.browser.version,10)<=6){return this}else{a=d.extend(a,e);return this.each(function(){var f=d(this);var g={"$select_field":f,options:a.extract_options(f),settings:a};g["$text_field"]=a.insert_text_field(g);a.handle_select_field(f);if(typeof a["autocomplete-plugin"]==="string"){b[a["autocomplete-plugin"]](g)}else{a["autocomplete-plugin"](g)}})}}};var b={jquery_ui:function(f){var i=function(l){var m=l.split(" ");var j=[];for(var k=0;k<m.length;k++){if(m[k].length>0){var n={};n.partial=new RegExp(d.ui.autocomplete.escapeRegex(m[k]),"i");if(f.settings["relevancy-sorting"]){n.strict=new RegExp("^"+d.ui.autocomplete.escapeRegex(m[k]),"i")}j.push(n)}}return d.grep(f.options,function(u){var o=0;if(f.settings["relevancy-sorting"]){var r=false;var t=u.matches.split(" ")}for(var s=0;s<j.length;s++){if(j[s]["partial"].test(u.matches)){o++}if(f.settings["relevancy-sorting"]){for(var v=0;v<t.length;v++){if(j[s]["strict"].test(t[v])){r=true;break}}}}if(f.settings["relevancy-sorting"]){var p=0;p+=o*f.settings["relevancy-sorting-partial-match-value"];if(r){p+=f.settings["relevancy-sorting-strict-match-value"]}p=p*u["relevancy-score-booster"];u["relevancy-score"]=p}return(!l||j.length===o)})};var g=function(j){var m;do{m=false;for(var l=0;l<j.length-1;l++){if(j[l]["relevancy-score"]<j[l+1]["relevancy-score"]){var k=j[l];j[l]=j[l+1];j[l+1]=k;m=true}}}while(m);return j};var h=function(j){if(f.settings.flags&&(typeof(j)!=="undefined")){d(f.settings["flags-image-selector"]).attr("src",f.settings["flags-dir"]+j.flag+".png")}};var e=function(k){if(k){if(f.$select_field.val()!==k["real-value"]){f.$select_field.val(k["real-value"]);h(k);if(f.settings.code&&f.settings["code-show"]){if(k.code){d(f.settings["code-selector"]).text("+"+k.code)}else{d(f.settings["code-selector"]).text("+"+f.settings["code-default"])}}f.$select_field.change()}}else{var l=f.$text_field.val().toLowerCase();var m={"real-value":false};for(var j=0;j<f.options.length;j++){if(l===f.options[j]["label"].toLowerCase()){m=f.options[j];break}}if(f.$select_field.val()!==m["real-value"]){f.$select_field.val(m["real-value"]||"");f.$select_field.change()}if(m["real-value"]){f.$text_field.val(m.label)}if(typeof f.settings.handle_invalid_input==="function"&&f.$select_field.val()===""){f.settings.handle_invalid_input(f)}}};f.$text_field.autocomplete({minLength:0,delay:0,autoFocus:true,source:function(k,j){var l=i(k.term);if(f.settings["relevancy-sorting"]){l=g(l)}j(l);if(k.term){h(l[0])}},select:function(j,k){e(k.item);var l=[k.item];h(l[0])},change:function(j,k){e(k.item)},search:function(j,k){}}).data("autocomplete")._renderItem=function(j,k){if(k.code){return d("<li>").data("item.autocomplete",k).append('<a><div class="flag-img"><img src="'+f.settings["flags-dir"]+k.flag+'.png" /></div><p class="country-name">'+k.text+'</p><p class="country-code">+'+k.code+'</p></a><div style="clear:both"></div>').appendTo(j)}else{return d("<li>").data("item.autocomplete",k).append('<a><div class="flag-img"><img src="'+f.settings["flags-dir"]+k.flag+'.png" /></div><p class="country-name">'+k.text+'</p><p class="country-code">&nbsp;</p></a><div style="clear:both"></div>').appendTo(j)}};f.$text_field.parents("form:first").submit(function(){e()});e();if(f.settings.flags){d(f.settings["flags-image-selector"]).click(function(){f.$text_field.autocomplete("search","")})}}};d.fn.selectToAutocomplete=function(e){if(c[e]){return c[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return c.init.apply(this,arguments)}else{d.error("Method "+e+" does not exist on jQuery.fn.selectToAutocomplete")}}}})(jQuery);